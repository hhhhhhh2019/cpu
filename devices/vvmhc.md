# VVMHC (virtual volatile memory host controller)

TYPE ID = 2

# Регистры

## Таблица регистров

размер - 37 байт

|адрес|название|описание|
|-:|:-:|-|
|0|STATE|состояние контроллера|
|1|COMMAND|команда|
|2|BLOCKCOUNT|кол-во блоков|
|4|STARTADDR|адрес в памяти диска, который используется командами|
|c|ADDRESS|адрес в ОЗУ, который используется командами|
|14|RESPONE|ответ от диска на команду|
|1c|ID|индекс диска|
|1d|TP|virt. mem. table pointer|

## Описание регистров

### STATE

|бит|название|описание|
|-|:-:|-|
|0|INIT|используется для инициализации контроллера|
|1|BUSY|указывает, что контроллер занят выполненем команды|

### COMMAND

|номер|название|описание|ответ|
|-|:-:|-|:-:|
|1|GET_CONNECTED|узнать какие слоты подключены|младшие 16 бит указывают, подключен ли диск к соответствующему слоту|
|2|GET_SIZE|спросить у диска его размер|зармер диска в байтах|
|3|READ|прочитать блоки с указанного диска|-|
|4|WRITE|записать блоки на указанный диск|-|

### BLOCKCOUNT

Кол-во 512-ух байтных блоков.

### STARTADDR

Адрес в диске, с которого начинается чтение/запись.

### ADDRESS

Адрес в ОЗУ, с котрого читается/записывется.

### RESPONE

Ответ на команду.

### ID

Номер диска, которому отправляется команда.

## TP

Указатель на таблицу вирт. памяти для чтения в пользовательское пространство. Если TP = 0, то вирт. адреса не используются.


# Алгоритмы

## Иницализация

Запиши в регистр STATE 1, он сбросится до 0, жди пока там снова появится 1.

## Чтение

Установи BLOCKCOUNT, STARTADDR, ADDRESS, ID.

STARTADDR - откуда начать читать.<br>
ADDRESS - куда записывать прочитанное.

### Запись

Установи BLOCKCOUNT, STARTADDR, ADDRESS, ID.

STARTADDR - куда записывть.<br>
ADDRESS - откуда читать.
