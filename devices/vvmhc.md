# VVMHC (virtual volatile memory host controller)

TYPE ID - 1

# Регистры

## Таблица регистров

|адрес|название|описание|
|-:|:-:|-|
|0|STATE|состояние контроллера|
|1|COMMAND|команда|
|2|BLOCKSIZE|размер блока|
|4|BLOCKCOUNT|кол-во блоков|
|6|STARTADDR|адрес в памяти диска, который используется командами|
|e|ADDRESS|адрес в ОЗУ, который используется командами|
|16|RESPONE|ответ от диска на команду|
|1e|ID|диску, с этим номером, посылается комада|
|1f|ALLOCSIZE|размер блока в ОЗУ, используется для чтения|

## Описание регистров

### STATE

|бит|название|описание|
|-|:-:|-|
|0|INIT|используется для инициализации контроллера|
|1|BUSY|указывает, что контроллер занят выполненем команды|
|2|PAUSE|используется для остановки чтения для "кусочного" чтения|

### COMMAND

|номер|название|описание|ответ|
|-|:-:|-|:-:|
|1|GET_CONNECTED|спросить у контроллера, какие слоты заняты|младшие 16 бит указывают, занят ли соответсвующий слот, остальные биты равны 0|
|2|GET_SIZE|спросить у диска его размер|зармер диска в байтах|
|3|READ|прочитать блоки с указанного диска|-|
|4|WRITE|записать блоки на указанный диск|-|
|5|SET_INTERRUPT|установить номер прерывания для выделения памяти при чтении(0x1 по умолчанию), использует ID как агрумент|-|

### BLOCKSIZE

Размер блока в битах.

### BLOCKCOUNT

Думаю, и так понятно.

### STARTADDR

Адрес в диске, с которого начинается чтение/запись.

### ADDRESS

Адрес в ОЗУ, с котрого читается/записывется.

### RESPONE

Ответ на команду.

### ID

Номер диска, которому отправляется команда.

### ALLOCSIZE

Размер блока в ОЗУ, используется для чтения.


# Алгоритмы

## Иницализация

Запиши в регистр STATE 1, она сбросится до 0, жди пока там снова появится 1.

## Чтение

Установи BLOCKSIZE, BLOCKCOUNT, STARTADDR, ADDRESS, ID, ALLOCSIZE.

STARTADDR - откуда начать читать.<br>
ADDRESS - куда записывать прочитанное.<br>
ALLOCSIZE - когда размер прочитанного будет равно этому значению, будет вызвено прерывние и PAUSE = 1. Когда вы установние PAUSE в 0, чтение продолжится. Этот регистр должен быть обновлён в прерывании.

### Запись

Установи BLOCKSIZE, BLOCKCOUNT, STARTADDR, ADDRESS, ID.

STARTADDR - куда записывть.<br>
ADDRESS - откуда читать.
